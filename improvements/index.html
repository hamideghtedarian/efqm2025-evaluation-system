<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ§­ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ØªØ­Ù„ÛŒÙ„ Ø¨Ù‡Ø¨ÙˆØ¯ Ùˆ Ø§Ø´ØªØ±Ø§Ú©Ø§Øª EFQM 2025</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Vazirmatn, Tahoma; background:#f6f8fb; padding:20px; color:#222; }
h1, h2 { color:#004aad; }
.card { background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:18px; margin-bottom:20px; }
button { background:#004aad; color:white; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; }
button:hover { background:#003b8e; }
table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
th, td { border:1px solid #e1e5eb; padding:8px; text-align:center; }
th { background:#e9f0ff; }
footer { text-align:center; margin-top:25px; color:#777; font-size:13px; }
header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
header img { height:60px; }
.badge { background:#dfe9ff; border-radius:10px; padding:4px 8px; margin:2px; display:inline-block; }
</style>
</head>
<body>

<header>
  <div>
    <h1>ğŸ§­ ØªØ­Ù„ÛŒÙ„ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯</h1>
    <p>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ùˆ ØªØ¬Ù…ÛŒØ¹ ÛŒØ§ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ú©ÛŒÙÛŒ Ø¯Ø± Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ EFQM 2025</p>
  </div>
  <img src="https://github.com/hamideghtedarian/hamideghtedarian-hamideghtedarian/blob/main/logo.png?raw=true">
</header>

<div class="card">
  <h2>ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§</h2>
  <input type="file" id="multiInput" multiple accept=".json">
  <p class="small">ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø®Ø±ÙˆØ¬ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ (criteria) Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ù†Ø¯.</p>
</div>

<div class="card">
  <h2>ğŸŒŸ ØªØ­Ù„ÛŒÙ„ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ ÙØ±ØµØªâ€ŒÙ‡Ø§</h2>
  <div id="summary"></div>
  <canvas id="improvementChart" style="max-width:800px;margin:auto;"></canvas>
</div>

<div class="card">
  <h2>ğŸ“‹ Ø¬Ø¯ÙˆÙ„ ÙØ±Ø§ÙˆØ§Ù†ÛŒ Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ø¨Ù‡Ø¨ÙˆØ¯ Ùˆ Ù‚ÙˆØª</h2>
  <div id="tableWrap">ÙØ§ÛŒÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
</div>

<div style="text-align:center;">
  <button onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾ / Ø°Ø®ÛŒØ±Ù‡ PDF</button>
</div>

<footer>
  <img src="https://github.com/hamideghtedarian/hamideghtedarian-hamideghtedarian/blob/main/banner.png?raw=true" style="max-width:250px;"><br>
  <p>Â© 2025 Hamid Eghtedarian â€” EFQM 2025 Improvement Analysis</p>
</footer>

<script>
let chart;

/* ======= Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ======= */
document.getElementById('multiInput').addEventListener('change', async e=>{
  const files=e.target.files;
  if(!files.length) return;
  const strengths=[], opportunities=[];
  for(const f of files){
    const text=await f.text();
    const json=JSON.parse(text);
    json.criteria.forEach(c=>{
      c.subcriteria.forEach(sc=>{
        sc.strengths?.forEach(s=>strengths.push(s.trim()));
        sc.opportunities?.forEach(o=>opportunities.push(o.trim()));
      });
    });
  }
  renderSummary(strengths, opportunities);
  renderTables(strengths, opportunities);
});

/* ======= Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ ======= */
function renderSummary(strengths, opportunities){
  const sCount=strengths.length, oCount=opportunities.length;
  document.getElementById('summary').innerHTML=`
    <p>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª: <b>${sCount}</b> | ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯: <b>${oCount}</b></p>
  `;
}

/* ======= Ø¬Ø¯ÙˆÙ„ Ùˆ ØªØ­Ù„ÛŒÙ„ ======= */
function renderTables(strengths, opportunities){
  const sFreq=frequency(strengths);
  const oFreq=frequency(opportunities);
  const allKeys=Array.from(new Set([...Object.keys(sFreq), ...Object.keys(oFreq)]));
  let html='<table><tr><th>Ù…ÙˆØ¶ÙˆØ¹</th><th>ØªÚ©Ø±Ø§Ø± Ø¯Ø± Ù‚ÙˆØªâ€ŒÙ‡Ø§</th><th>ØªÚ©Ø±Ø§Ø± Ø¯Ø± ÙØ±ØµØªâ€ŒÙ‡Ø§</th></tr>';
  allKeys.forEach(k=>{
    html+=`<tr><td>${k}</td><td>${sFreq[k]||0}</td><td>${oFreq[k]||0}</td></tr>`;
  });
  html+='</table>';
  document.getElementById('tableWrap').innerHTML=html;

  const labels=allKeys.slice(0,20); // ÙÙ‚Ø· Û²Û° Ù…ÙˆØ¶ÙˆØ¹ Ù¾Ø±ØªÚ©Ø±Ø§Ø±
  const sVals=labels.map(l=>sFreq[l]||0);
  const oVals=labels.map(l=>oFreq[l]||0);

  const ctx=document.getElementById('improvementChart').getContext('2d');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'Ù†Ù‚Ø§Ø· Ù‚ÙˆØª',data:sVals,backgroundColor:'#00b89499'},
        {label:'ÙØ±ØµØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯',data:oVals,backgroundColor:'#e1705599'}
      ]
    },
    options:{
      responsive:true,
      scales:{y:{beginAtZero:true}},
      plugins:{legend:{position:'bottom'}}
    }
  });
}

/* ======= Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ±Ø§ÙˆØ§Ù†ÛŒ ======= */
function frequency(arr){
  const freq={};
  arr.forEach(a=>{
    if(!a) return;
    const key=a.replace(/[ØŒ.,;]/g,'').trim();
    freq[key]=(freq[key]||0)+1;
  });
  return freq;
}
</script>
</body>
</html>
