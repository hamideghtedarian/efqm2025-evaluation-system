<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ØªØ­Ù„ÛŒÙ„ÛŒ EFQM 2025</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Vazirmatn, Tahoma; background:#f6f8fb; margin:0; padding:20px; color:#222; }
h1, h2 { color:#004aad; margin-bottom:8px; }
.card { background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:18px; margin-bottom:20px; }
table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
th, td { border:1px solid #e1e5eb; padding:8px; text-align:center; }
th { background:#e9f0ff; }
button { background:#004aad; color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; }
button:hover { background:#003b8e; }
header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
#logo { height:60px; }
.chart-container { width:100%; max-width:700px; margin:auto; }
footer { text-align:center; margin-top:30px; color:#777; font-size:13px; }
</style>
</head>
<body>
<button onclick="window.open('../help/dashboard.html', '_blank')">â“ Ø±Ø§Ù‡Ù†Ù…Ø§</button>

<header>
  <div>
    <h1>ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ EFQM 2025</h1>
    <p style="margin:0;">Ù†Ù…Ø§ÛŒØ´ ØªØ­Ù„ÛŒÙ„ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ùˆ Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯</p>
  </div>
  <img id="logo" src="https://github.com/hamideghtedarian/hamideghtedarian-hamideghtedarian/blob/main/logo.png?raw=true" alt="Ù„ÙˆÚ¯Ùˆ" />
</header>

<div class="card">
  <h2>ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø±Ú©Øª</h2>
  <input type="file" id="jsonInput" accept=".json" />
  <p class="small">ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø®Ø±ÙˆØ¬ÛŒ ÙØ±Ù… Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ (criteria) ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.</p>
</div>

<div class="card">
  <h2>ğŸ§­ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡ Ø³Ø§Ø²Ù…Ø§Ù†</h2>
  <div id="meta"></div>
</div>

<div class="card">
  <h2>ğŸ“ˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ø§Ù…ØªÛŒØ§Ø² Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§</h2>
  <div class="chart-container"><canvas id="barChart"></canvas></div>
</div>

<div class="card">
  <h2>ğŸ•¸ï¸ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±Ø§Ø¯Ø§Ø±ÛŒ EFQM 2025</h2>
  <div class="chart-container"><canvas id="radarChart"></canvas></div>
</div>

<div class="card">
  <h2>ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø®Ù„Ø§ØµÙ‡ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</h2>
  <div id="tableWrap">ÙØ§ÛŒÙ„ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
</div>

<div style="text-align:center;">
  <button onclick="window.print()">ğŸ–¨ï¸ Ú†Ø§Ù¾ / Ø°Ø®ÛŒØ±Ù‡ PDF</button>
</div>

<footer>
  <img src="https://github.com/hamideghtedarian/hamideghtedarian-hamideghtedarian/blob/main/banner.png?raw=true" style="max-width:250px; margin-top:10px;"><br>
  <p>Â© 2025 Hamid Eghtedarian â€” EFQM 2025 Evaluation System</p>
</footer>

<script>
let barChart, radarChart;

/* ======= Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ ======= */
document.getElementById('jsonInput').addEventListener('change', e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    const data=JSON.parse(reader.result);
    renderDashboard(data);
  };
  reader.readAsText(file);
});

/* ======= Ø±Ù†Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ======= */
function renderDashboard(data){
  renderMeta(data.metadata);
  const scores=data.criteria.map(c=>({id:c.criterion_id, score:c.average_score||0}));
  renderCharts(scores);
  renderTable(data.criteria);
}

/* ======= Ù†Ù…Ø§ÛŒØ´ Ù…ØªØ§Ø¯ÛŒØªØ§ ======= */
function renderMeta(meta){
  const div=document.getElementById('meta');
  div.innerHTML=`
    <table>
      <tr><th>Ø³Ø§Ø²Ù…Ø§Ù†</th><td>${meta.organization}</td></tr>
      <tr><th>ØªØ§Ø±ÛŒØ® Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</th><td>${meta.evaluation_date}</td></tr>
      <tr><th>ØªÛŒÙ… Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</th><td>${meta.evaluator_team.join(', ')}</td></tr>
      <tr><th>Ù†Ø³Ø®Ù‡ Ù…Ø¯Ù„</th><td>${meta.model_version}</td></tr>
    </table>`;
}

/* ======= Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ ======= */
function renderCharts(scores){
  const labels=scores.map(s=>'Ù…Ø¹ÛŒØ§Ø± '+s.id);
  const dataVals=scores.map(s=>s.score);
  const ctx1=document.getElementById('barChart').getContext('2d');
  const ctx2=document.getElementById('radarChart').getContext('2d');
  if(barChart) barChart.destroy();
  if(radarChart) radarChart.destroy();

  barChart=new Chart(ctx1,{
    type:'bar',
    data:{labels,datasets:[{label:'Ø§Ù…ØªÛŒØ§Ø² Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§',data:dataVals,backgroundColor:'#004aad88'}]},
    options:{scales:{y:{beginAtZero:true,max:100}},plugins:{legend:{display:false}}}
  });

  radarChart=new Chart(ctx2,{
    type:'radar',
    data:{labels,datasets:[{label:'EFQM 2025',data:dataVals,backgroundColor:'#004aad44',borderColor:'#004aad',pointBackgroundColor:'#004aad'}]},
    options:{scales:{r:{min:0,max:100,ticks:{stepSize:20}}}}
  });
}

/* ======= Ø¬Ø¯ÙˆÙ„ ======= */
function renderTable(criteria){
  let html='<table><tr><th>Ù…Ø¹ÛŒØ§Ø±</th><th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²</th><th>Ø²ÛŒØ±Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§</th></tr>';
  criteria.forEach(c=>{
    const subs=c.subcriteria.map(s=>`${s.subId} (${s.score??'-'})`).join(', ');
    html+=`<tr><td>${c.criterion_id}</td><td>${c.average_score?.toFixed(1)??'-'}</td><td>${subs}</td></tr>`;
  });
  html+='</table>';
  document.getElementById('tableWrap').innerHTML=html;
}
</script>
</body>
</html>
